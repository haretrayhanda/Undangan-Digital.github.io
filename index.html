<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Undangan Pernikahan ‚Äî Haret & Jauza (Tema Dark Mewah ‚Äî Portrait Cinematic)</title>
  <meta name="description" content="Undangan pernikahan digital Haret & Jauza ‚Äî tema dark mewah elegan dengan fokus foto portrait, slider cinematic, dan kartu glass." />
  <meta name="theme-color" content="#0d1016" />
  <style>
    /* ======== TEMA DARK (hitam‚Äìemas) ======== */
    :root{
      --ink:#f5f6f8;
      --muted:#b6bcc9;
      --veil:rgba(8,10,14,.58);
      --gold:#d8b65a;
      --gold-2:#c29b3d;
      --line:rgba(255,255,255,.18);
      --card:rgba(18,20,26,.55);
      --card-2:rgba(18,20,26,.45);
      --glass-blur:10px;
      --btn-fg:#fff;
      --btn-bg1:#1b1b1b; --btn-bg2:#101010;
      --bg-img:url('img/background2.jpg');
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%;scroll-behavior:smooth}
    body{
      color:var(--ink);
      font-family: ui-serif, "Cormorant Garamond", "Playfair Display", "Times New Roman", serif;
      background:
        linear-gradient(180deg,var(--veil),rgba(0,0,0,0)),
        var(--bg-img) center/cover no-repeat;
      background-attachment:scroll !important;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    img{max-width:100%;display:block;height:auto}
    a{color:var(--gold);text-decoration:none}
    section{padding:80px 18px}
    .container{max-width:1080px;margin:0 auto}
    .center{text-align:center}
    .hide{display:none !important}

    /* Background per section & footer */
    section, footer{ position:relative; isolation:isolate; background:transparent; }
    section::before, footer::before{
      content:""; position:absolute; inset:0; z-index:-1;
      background:
        linear-gradient(180deg, rgba(0,0,0,0.66), rgba(0,0,0,0.35)),
        var(--bg-img) center/cover no-repeat fixed;
    }
    section:nth-of-type(even)::before{
      background:
        linear-gradient(180deg, rgba(0,0,0,0.50), rgba(0,0,0,0.72)),
        var(--bg-img) center/cover no-repeat fixed;
    }

    /* Tipografi */
    .overline{
      letter-spacing:.22em;
      text-transform:uppercase;
      font-size:.78rem;
      color:var(--gold);
      font-weight:700;
    }
    .title{
      font-size:clamp(28px,5vw,40px);
      letter-spacing:.2px;
      margin:.1rem 0 12px;
    }
    .subtitle{
      color:var(--muted);
      margin:0 0 22px;
    }
    .names{
      font-size:clamp(46px,8vw,82px);
      line-height:1.06;
      margin:.25em 0 .1em;
      letter-spacing:.5px;
      font-weight:800;
      background:linear-gradient(90deg,#e9edf5 0%,#bfc8da 50%,#eef2f8 100%);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .script{font-style:italic;font-weight:600;letter-spacing:.02em}

    .chip{
      display:inline-flex;
      gap:.5rem;
      align-items:center;
      padding:8px 14px;
      border-radius:999px;
      background:var(--card-2);
      border:1px solid var(--line);
      font-weight:700;
      color:var(--ink);
    }

    /* Ornament garis lengkung */
    .ornament{display:block;margin:18px auto 6px;width:120px;height:16px}
    .ornament path{
      stroke:var(--gold);
      stroke-width:1.2;
      fill:none;
      stroke-linecap:round;
      opacity:.9;
    }

    /* Tombol */
    .btn{
      display:inline-flex;
      align-items:center;
      gap:.6rem;
      padding:14px 18px;
      border-radius:999px;
      min-height:48px;
      border:1px solid var(--gold-2);
      background:linear-gradient(180deg,var(--btn-bg1),var(--btn-bg2));
      color:var(--btn-fg);
      font-weight:800;
      letter-spacing:.02em;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.ghost{
      background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));
      color:#e9edf5;
      border:1px solid rgba(255,255,255,.25);
    }

    /* Kartu & grid */
    .grid-2{
      display:grid;
      gap:20px;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:20px;
      padding:20px;
      backdrop-filter:blur(var(--glass-blur));
      -webkit-backdrop-filter:blur(var(--glass-blur));
    }
    .card.soft{background:var(--card-2)}
    .soft{color:var(--muted)}
    .cap{font-size:.92rem;color:var(--muted)}

    /* Hero */
    header.hero{
      position:relative;
      min-height:100svh;
      display:grid;
      place-items:center;
    }
    @supports (min-height: 100dvh){
      header.hero{ min-height:100dvh }
    }
    .hero .wrap{max-width:820px;margin:0 16px}
    .hero-card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:28px;
      padding:28px;
      backdrop-filter:blur(calc(var(--glass-blur) + 2px));
    }
    .scroll-cue{
      position:absolute;
      bottom:22px;
      left:50%;
      transform:translateX(-50%);
      color:var(--ink);
      font-weight:600;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      opacity:.9;
    }
    .mouse{
      width:24px;
      height:36px;
      border:2px solid var(--ink);
      border-radius:16px;
      position:relative;
    }
    .mouse::after{
      content:"";
      position:absolute;
      left:50%;
      top:6px;
      width:4px;
      height:6px;
      background:var(--ink);
      border-radius:2px;
      transform:translateX(-50%);
      animation:wheel 1.6s ease-in-out infinite;
    }
    @keyframes wheel{
      0%{opacity:0;transform:translate(-50%,0)}
      40%{opacity:1}
      100%{opacity:0;transform:translate(-50%,10px)}
    }

    /* ================= CINEMATIC SLIDESHOW ‚Äî PORTRAIT ================= */
    .cinema{
      position:relative;
      border:1px solid var(--line);
      border-radius:20px;
      overflow:hidden;
      background:var(--card-2);
      max-width:min(92vw,480px);
      margin:0 auto;
    }
    .stage{
      position:relative;
      isolation:isolate;
      aspect-ratio:3/4;
      max-height:78svh;
      cursor:pointer;
    }
    @media (min-width:768px){
      .stage{max-height:80svh}
    }

    /* UPDATED: remove zoom/pan animation, keep fade only */
    .frame{
      position:absolute;
      inset:0;
      opacity:0;
      transition:opacity 1.0s ease;
      will-change:opacity;
    }
    .frame img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter:saturate(1.03) contrast(1.02);
    }
    .frame.active{
      opacity:1;
    }

    /* Progress bar */
    .progress{
      position:absolute;
      left:0;
      right:0;
      top:0;
      height:3px;
      background:rgba(255,255,255,.18);
    }
    .progress::after{
      content:"";
      position:absolute;
      left:0;
      top:0;
      bottom:0;
      width:var(--w,0%);
      background:linear-gradient(90deg,#ffe9a6,var(--gold-2));
      transition:width .1s linear;
    }

    /* Nav & thumbs */
    .navBtn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      border:none;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
      background:rgba(0,0,0,.35);
      color:#fff;
      backdrop-filter:blur(6px);
    }
    .navBtn:hover{background:rgba(0,0,0,.5)}
    .prev{left:10px}
    .next{right:10px}

    .thumbs{
      display:flex;
      gap:8px;
      overflow:auto;
      padding:10px;
      background:transparent;
      scroll-snap-type:x mandatory;
      justify-content:center;
    }
    .thumbs button{
      flex:0 0 auto;
      width:64px;
      height:86px;
      border-radius:12px;
      border:1px solid var(--line);
      overflow:hidden;
      background:transparent;
      cursor:pointer;
      opacity:.65;
      scroll-snap-align:start;
    }
    .thumbs button[aria-current="true"]{
      opacity:1;
      outline:2px solid var(--gold-2);
    }
    .thumbs img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* Timeline */
    .timeline{
      position:relative;
      margin:0;
      padding:0;
      list-style:none;
    }
    .timeline:before{
      content:"";
      position:absolute;
      top:0;
      bottom:0;
      left:12px;
      width:2px;
      background:linear-gradient(180deg,rgba(255,255,255,.25),rgba(255,255,255,.10));
      border-radius:2px;
    }
    .timeline li{
      position:relative;
      padding-left:42px;
      margin:18px 0;
    }
    .timeline li:before{
      content:"";
      position:absolute;
      left:4px;
      top:.45rem;
      width:16px;
      height:16px;
      border-radius:50%;
      background:radial-gradient(circle at 35% 35%, #ffe9a6 0%, #e0bf63 40%, var(--gold-2) 100%);
      box-shadow:0 0 0 4px rgba(255,255,255,.10);
    }
    .date{font-weight:800;color:var(--ink)}

    /* Bank */
    .bank{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
    }
    .bank .acc{flex:1 1 320px}
    .acc .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      background:var(--card-2);
      border:1px dashed rgba(255,255,255,.25);
      padding:12px;
      border-radius:14px;
    }
    .copy{
      padding:10px 14px;
      border-radius:10px;
      border:1px solid var(--gold-2);
      background:linear-gradient(180deg,var(--btn-bg1),var(--btn-bg2));
      color:var(--btn-fg);
      cursor:pointer;
      min-height:44px;
    }

    /* Ucapan */
    .ucapan form{
      display:grid;
      gap:10px;
      margin-bottom:16px;
    }
    .ucapan input,.ucapan textarea{
      padding:14px;
      border:1px solid var(--line);
      border-radius:12px;
      font:inherit;
      background:var(--card-2);
      color:var(--ink);
    }
    .ucapan textarea{
      min-height:110px;
      resize:vertical;
    }
    .list{
      display:grid;
      gap:12px;
    }
    .msg{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
    }
    .msg .time{
      font-size:.95rem;
      color:var(--muted);
    }

    /* Dialog */
    dialog#lightbox{
      border:none;
      border-radius:16px;
      padding:0;
      max-width:min(92vw,1000px);
      background:#111;
    }
    dialog::backdrop{
      background:rgba(0,0,0,.55);
    }
    .lightbox-wrap{
      position:relative;
    }
    .lightbox-wrap img{
      max-height:80svh;
      max-width:100%;
      width:auto;
      height:auto;
    }
    .closeX{
      position:absolute;
      right:10px;
      top:10px;
      border:none;
      background:rgba(255,255,255,.2);
      color:#fff;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
    }

    /* Audio FAB */
    .audio-fab{
      position:fixed;
      right:18px;
      bottom:calc(18px + env(safe-area-inset-bottom));
      z-index:30;
    }
    .fab{
      border:1px solid var(--gold-2);
      background:linear-gradient(180deg,var(--btn-bg1),var(--btn-bg2));
      color:var(--btn-fg);
      width:56px;
      height:56px;
      border-radius:50%;
      display:grid;
      place-items:center;
      cursor:pointer;
      font-size:22px;
    }

    /* Footer */
    footer{
      padding:38px 16px;
      text-align:center;
      border-top:none;
      position:relative;
    }
    footer small{color:var(--muted)}

    /* Non-efek per page */
    .reveal-up{
      opacity:1 !important;
      transform:none !important;
      transition:none !important;
    }
  </style>
</head>
<body>

<!-- ===== HERO (PRE-OPEN) ===== -->
<header class="hero" id="splash" aria-label="Pembuka">
  <div class="wrap">
    <div class="hero-card center">
      <svg class="ornament" viewBox="0 0 120 16" aria-hidden="true">
        <path d="M4 8 H46 M74 8 H116 M46 8 C52 2, 68 2, 74 8 C68 14, 52 14, 46 8" />
      </svg>
      <!-- Dear: bigger + gold -->
      <p class="subtitle"
         style="margin-bottom:4px;font-size:1.1rem;color:var(--gold);">
        Dear,
      </p>
      <!-- SPECIAL GUEST: smaller -->
      <h2 class="title"
          style="margin:0 0 6px;font-size:.9rem;letter-spacing:.18em;">
        "SPECIAL GUEST"
      </h2>
      <!-- You are warmly invited: bigger + gold -->
      <p class="subtitle"
         style="margin-top:0;margin-bottom:10px;font-size:1.05rem;color:var(--gold);">
        You are warmly invited to celebrate the wedding of :
      </p>
      <h1 class="names" aria-label="Haret dan Jauza">Haret &amp; Jauza</h1>
      <div class="center" style="margin-top:24px">
        <button class="btn" id="openBtn">Open</button>
      </div>
    </div>
  </div>
  <div class="scroll-cue" aria-hidden="true">
    <div class="mouse"></div>
    <small>Scroll down</small>
  </div>
</header>

<main id="main" class="hide" tabindex="-1">
  <!-- ===== AYAT + COUNTDOWN ===== -->
  <section>
    <div class="container center">
      <div class="card" style="max-width:820px;margin:0 auto;">
        <svg class="ornament" viewBox="0 0 120 16" aria-hidden="true">
          <path d="M4 8 H46 M74 8 H116 M46 8 C52 2, 68 2, 74 8 C68 14, 52 14, 46 8" />
        </svg>
        <p class="script" style="white-space:pre-line;margin-bottom:10px;">
Dan di antara tanda-tanda (kebesaran)-Nya
ialah Dia menciptakan pasang-pasangan untukmu dari jenismu sendiri,
agar kamu cenderung dan merasa tentram kepadanya,
dan Dia menjadikan di antaramu rasa kasih dan sayang.
Sungguh, pada yang demikian itu benar-benar terdapat
tanda-tanda (kebesaran Allah) bagi kaum yang berpikir.
        </p>
        <p class="cap" style="margin-top:0;">Surah Ar-Rum : 21</p>
        <div class="chip" id="countdown" aria-live="polite" style="margin-top:14px;">
          Counting‚Ä¶
        </div>
      </div>
    </div>
  </section>

  <!-- ===== PASANGAN ===== -->
  <section>
    <div class="container center">
      <svg class="ornament" viewBox="0 0 120 16" aria-hidden="true">
        <path d="M4 8 H46 M74 8 H116 M46 8 C52 2, 68 2, 74 8 C68 14, 52 14, 46 8" />
      </svg>
      <h2 class="title">Assalamu‚Äôalaikum Wr. Wb.</h2>
      <p class="subtitle">Dengan penuh rasa syukur, kami yang berbahagia:</p>

      <div class="card" style="max-width:720px;margin:18px auto 0;">
        <img src="img/haret.jpg" alt="Foto Calon Mempelai" loading="lazy"
             style="border-radius:16px;aspect-ratio:3/4;object-fit:cover;margin-bottom:16px;">
        <h3 style="margin:.2rem 0 .25rem;font-size:1.35rem;">Rahmad Haret Rayhanda, S.T.</h3>
        <p class="soft">Putra Kedua dari Bapak Ahmad Daniel &amp; Ibu Yuliastuti</p>
        <div style="margin:10px 0;color:var(--gold);font-weight:600;">&amp;</div>
        <h3 style="margin:.2rem 0 .25rem;font-size:1.35rem;">Jauza Dalilah Irbah, S.T.</h3>
        <p class="soft">Putri Kedua dari Bapak Drs. Syuriadi &amp; Ibu Ns. Venny Dwita Zola Anwar, S.Kep</p>
      </div>
    </div>
  </section>

  <!-- ===== ACARA & LOKASI ===== -->
  <section>
    <div class="container">
      <div class="grid-2">
        <div class="card">
          <h3 class="title" style="font-size:28px">Rangkaian Acara</h3>
          <ul class="timeline">
            <li>
              <strong>Akad Nikah</strong><br>
              <small class="date">Jum'at, 27 Mar 2026 ‚Ä¢ 08.00 WIB</small><br>
              <span class="soft">Aru Indah, Padang</span>
            </li>
            <li>
              <strong>Resepsi</strong><br>
              <small class="date">Sabtu, 28 Mar 2026 ‚Ä¢ 11.00‚Äì14.00 WIB</small><br>
              <span class="soft">Aru Indah, Padang</span>
            </li>
          </ul>
          <p class="cap" style="margin-top:10px">Countdown menuju resepsi ditampilkan di bagian atas.</p>
        </div>

        <div class="card soft">
          <h3 class="title" style="font-size:28px">Lokasi</h3>
          <p class="soft">
            Jl. Aru Indah 17, Lubuk Begalung Nan XX, Kec. Lubuk Begalung, Kota Padang.
          </p>

          <!-- Center the button -->
          <div style="text-align:center; margin-top:12px;">
            <a class="btn" target="_blank" rel="noopener" href="https://maps.app.goo.gl/wc1DLdaEXPexQ2a68">
              üìç Buka Google Maps
            </a>
          </div>

          <p style="margin-top:12px">
            <small class="soft">Parkir tersedia. Mohon hadir tepat waktu.</small>
          </p>

          <!-- Denah Image with lightbox -->
          <div style="text-align:center; margin-top:20px;">
            <h4>Denah Lokasi</h4>
            <img src="img/denah.png" alt="Denah Lokasi" style="max-width:100%; border-radius:12px; border:1px solid var(--line);" id="mapImage">
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== GALERI ===== -->
  <section>
    <div class="container">
      <svg class="ornament" viewBox="0 0 120 16" aria-hidden="true">
        <path d="M4 8 H46 M74 8 H116 M46 8 C52 2, 68 2, 74 8 C68 14, 52 14, 46 8" />
      </svg>
      <h2 class="title center">Galeri Prewedding</h2>
      <p class="subtitle center">
        Ketuk foto untuk melihat tampilan penuh, geser (swipe) atau gunakan tombol untuk mengganti foto.
      </p>

      <div class="cinema" id="cinema" aria-roledescription="carousel" aria-label="Galeri Prewedding">
        <div class="progress" id="progress"></div>
        <div class="stage" id="stage" role="group">
          <figure class="frame active"><img src="img/pre1.jpg" alt="Prewed 1"></figure>
          <figure class="frame"><img src="img/pre2.jpg" alt="Prewed 2"></figure>
          <figure class="frame"><img src="img/pre3.jpg" alt="Prewed 3"></figure>
          <figure class="frame"><img src="img/pre4.jpg" alt="Prewed 4"></figure>
          <figure class="frame"><img src="img/pre5.jpg" alt="Prewed 5"></figure>
          <figure class="frame"><img src="img/pre6.jpg" alt="Prewed 6"></figure>
          <figure class="frame"><img src="img/pre7.jpg" alt="Prewed 7"></figure>
        </div>
        <button class="navBtn prev" type="button" aria-label="Sebelumnya" id="prevBtn">‚Äπ</button>
        <button class="navBtn next" type="button" aria-label="Berikutnya" id="nextBtn">‚Ä∫</button>
      </div>

      <div class="thumbs" id="thumbs" aria-label="Pilih foto">
        <button type="button" aria-label="Slide 1" aria-current="true"><img src="img/pre1.jpg" alt=""></button>
        <button type="button" aria-label="Slide 2"><img src="img/pre2.jpg" alt=""></button>
        <button type="button" aria-label="Slide 3"><img src="img/pre3.jpg" alt=""></button>
        <button type="button" aria-label="Slide 4"><img src="img/pre4.jpg" alt=""></button>
        <button type="button" aria-label="Slide 5"><img src="img/pre5.jpg" alt=""></button>
        <button type="button" aria-label="Slide 6"><img src="img/pre6.jpg" alt=""></button>
        <button type="button" aria-label="Slide 7"><img src="img/pre7.jpg" alt=""></button>
      </div>
    </div>
  </section>

  <!-- ===== UCAPAN ===== -->
  <section class="ucapan" id="ucapan">
    <div class="container">
      <div class="card">
        <svg class="ornament" viewBox="0 0 120 16" aria-hidden="true">
          <path d="M4 8 H46 M74 8 H116 M46 8 C52 2, 68 2, 74 8 C68 14, 52 14, 46 8" />
        </svg>
        <h2 class="title center">Kirim Ucapan &amp; Doa</h2>
        <form id="formUcapan" autocomplete="on">
          <input id="nama" name="nama" placeholder="Nama Anda" required>
          <textarea id="pesan" name="pesan" placeholder="Tulis ucapan terbaik Anda‚Ä¶" required></textarea>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" type="submit">üíå Kirim Ucapan</button>
            <button class="btn ghost" type="button" id="btnClear">Bersihkan Semua</button>
          </div>
        </form>
        <div class="list" id="listUcapan" aria-live="polite"></div>
      </div>
    </div>
  </section>

  <!-- ===== AMPLOP DIGITAL ===== -->
  <section>
    <div class="container">
      <svg class="ornament" viewBox="0 0 120 16" aria-hidden="true">
        <path d="M4 8 H46 M74 8 H116 M46 8 C52 2, 68 2, 74 8 C68 14, 52 14, 46 8" />
      </svg>
      <h2 class="title center">Wedding Gift</h2>
      <p class="subtitle center">Doa restu Anda merupakan hadiah terindah bagi kami.
Namun apabila ingin turut memberikan hadiah dalam bentuk lain, dapat dikirimkan melalui:</p>

      <div class="bank">
        <div class="card acc">
          <h3>Bank BSI</h3>
          <div class="row">
            <div>
              <div><strong>No. Rekening</strong><br><span id="bsiNo">108162051672</span></div>
              <small class="soft">a.n. Rahmad Haret Rayhanda</small>
            </div>
            <button class="copy" data-copy="#bsiNo">Salin</button>
          </div>
          <p class="cap">Catatan: Mohon konfirmasi jika sudah transfer.</p>
          <img class="qr" src="img/bsi.png" alt="QR BSI / QRIS"
               style="max-width:160px;border-radius:12px;border:1px solid var(--line)">
        </div>

        <div class="card acc">
          <h3>Bank Jago</h3>
          <div class="row">
            <div>
              <div><strong>No. Rekening</strong><br><span id="jagoNo">101127198673</span></div>
              <small class="soft">a.n. Jauza Dalilah Irbah</small>
            </div>
            <button class="copy" data-copy="#jagoNo">Salin</button>
          </div>
          <p class="cap">Catatan: Mohon konfirmasi jika sudah transfer.</p>
          <img class="qr" src="img/jago.png" alt="QR Jago / QRIS"
               style="max-width:160px;border-radius:12px;border:1px solid var(--line)">
        </div>
      </div>
    </div>
  </section>

  <!-- ===== PENUTUP ===== -->
  <section class="center">
    <div class="container">
      <div class="card">
        <h2 class="title">Terima Kasih</h2>
        <p class="soft">
          Doa dan kehadiran Anda adalah kebahagiaan bagi kami.<br>
          Wassalamu‚Äôalaikum Wr. Wb.
        </p>
      </div>
    </div>
  </section>
</main>

<!-- ===== FOOTER ===== -->
<footer>
  <small>¬© 2026 RETTVERSE DIGITAL.</small>
</footer>

<!-- ===== AUDIO FAB ===== -->
<audio id="backsound" src="backsound.mp3" loop preload="auto"></audio>
<div class="audio-fab hide" id="audioCtrls">
  <button class="fab" id="toggleAudio" title="Putar/Jeda Musik">‚ô´</button>
</div>

<!-- ===== LIGHTBOX ===== -->
<dialog id="lightbox" aria-label="Tampilan layar penuh">
  <div class="lightbox-wrap">
    <img id="lightboxImg" alt="Foto prewed">
    <button class="closeX" id="closeLightbox">Tutup ‚úï</button>
  </div>
</dialog>

<script>
(function(){
  const $  = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);

  const splash      = $('#splash');
  const main        = $('#main');
  const backsound   = $('#backsound');
  const audioCtrls  = $('#audioCtrls');
  const toggleAudio = $('#toggleAudio');
  const openBtn     = $('#openBtn');
  const cd          = $('#countdown');

  /* AUDIO */
  backsound.volume = 0.5;
  openBtn.addEventListener('click', async () => {
    splash.classList.add('hide');
    main.classList.remove('hide');
    audioCtrls.classList.remove('hide');
    try{
      await backsound.play();
      toggleAudio.textContent = '‚ùö‚ùö';
    }catch{
      toggleAudio.textContent = '‚ñ∂';
    }
    main.scrollIntoView({behavior:'smooth'});
  });

  async function fade(to, ms=400){
    const from = backsound.volume;
    const steps = 20;
    const dt = ms/steps;
    for(let i=0;i<=steps;i++){
      await new Promise(r=>setTimeout(r,dt));
      backsound.volume = from + (to-from)*i/steps;
    }
  }

  toggleAudio.addEventListener('click', async () => {
    if(backsound.paused){
      backsound.play();
      await fade(.5);
      toggleAudio.textContent='‚ùö‚ùö';
    }else{
      await fade(0);
      backsound.pause();
      toggleAudio.textContent='‚ñ∂';
      backsound.volume=.5;
    }
  });

  /* COUNTDOWN */
  const evtDate = new Date('2026-03-28T11:00:00+07:00').getTime();
  setInterval(()=>{
    const d = Math.max(evtDate - Date.now(), 0);
    const day = Math.floor(d/86400000);
    const hr  = Math.floor((d%86400000)/3600000);
    const mn  = Math.floor((d%3600000)/60000);
    const sc  = Math.floor((d%60000)/1000);
    const z = n => String(n).padStart(2,'0');
    if(cd){
      cd.textContent = `${day} hari ${z(hr)}:${z(mn)}:${z(sc)}`;
    }
  },1000);

  /* GALERI CINEMATIC */
  const stage    = document.getElementById('stage');
  const frames   = Array.from(stage.querySelectorAll('.frame'));
  const progress = document.getElementById('progress');
  const prevBtn  = document.getElementById('prevBtn');
  const nextBtn  = document.getElementById('nextBtn');
  const thumbs   = document.getElementById('thumbs');
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightboxImg');

  let idx = 0, auto = true, tStart = 0, rafId = null;
  const DURATION = 4800;

  function lazy(i){
    const img = frames[i]?.querySelector('img');
    if(img && img.dataset.src){
      img.src = img.dataset.src;
      img.removeAttribute('data-src');
    }
  }

  function setActive(i){
    frames.forEach((f,k)=>{ f.classList.toggle('active', k===i); });
    if(thumbs){
      thumbs.querySelectorAll('button').forEach((b,k)=>
        b.setAttribute('aria-current', k===i ? 'true':'false')
      );
    }
    lazy(i);
    lazy((i+1)%frames.length);
    tStart = performance.now();
    if(rafId) cancelAnimationFrame(rafId);

    const tick = (now)=>{
      const p = Math.min(1, (now - tStart)/DURATION);
      progress.style.setProperty('--w', (p*100)+'%');
      if(p<1 && auto){
        rafId = requestAnimationFrame(tick);
      }else if(auto){
        next();
      }
    };
    rafId = requestAnimationFrame(tick);
  }

  function go(i){
    idx = (i + frames.length) % frames.length;
    setActive(idx);
  }
  function next(){ go(idx+1); }
  function prev(){ go(idx-1); }

  function start(){
    auto = true;
    setActive(idx);
  }
  function stop(){
    auto = false;
    if(rafId) cancelAnimationFrame(rafId);
  }

  if(prevBtn){
    prevBtn.addEventListener('click', ()=>{
      stop();
      prev();
      start();
    });
  }
  if(nextBtn){
    nextBtn.addEventListener('click', ()=>{
      stop();
      next();
      start();
    });
  }

  if(thumbs){
    thumbs.addEventListener('click', (e)=>{
      const b = e.target.closest('button');
      if(!b) return;
      const buttons = Array.from(thumbs.children);
      const i = buttons.indexOf(b);
      if(i<0) return;
      stop();
      go(i);
      start();
      const frameImg = frames[i].querySelector('img');
      const src = frameImg?.currentSrc || frameImg?.src || frameImg?.dataset.src;
      if(src){
        lightboxImg.src = src;
        lightbox.showModal();
      }
      b.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
    });
  }

  /* Swipe */
  let startX=0, curX=0, touching=false;
  stage.addEventListener('touchstart', e=>{
    touching=true;
    startX=e.touches[0].clientX;
    curX=startX;
    stop();
  }, {passive:true});
  stage.addEventListener('touchmove', e=>{
    if(!touching) return;
    curX=e.touches[0].clientX;
  }, {passive:true});
  stage.addEventListener('touchend', ()=>{
    if(!touching) return;
    const dx = curX-startX;
    touching=false;
    if(Math.abs(dx)>40){
      dx<0 ? next() : prev();
    }
    start();
  });

  /* Klik frame => lightbox */
  stage.addEventListener('click', (e)=>{
    const img = e.target.closest('img');
    if(!img) return;
    const src = img.currentSrc || img.src || img.dataset.src;
    if(!src) return;
    lightboxImg.src = src;
    lightbox.showModal();
  });

  /* LIGHTBOX */
  const closeLightbox = $('#closeLightbox');
  closeLightbox.addEventListener('click', ()=>{
    lightbox.close();
  });
  lightbox.addEventListener('click',(e)=>{
    if(e.target === lightbox) lightbox.close();
  });
  lightbox.addEventListener('close', start);
  lightbox.addEventListener('cancel', e=>{
    e.preventDefault();
    lightbox.close();
    start();
  });

  /* COPY REKENING */
  $$('.copy').forEach(btn=>{
    btn.addEventListener('click', async ()=>{
      const sel = btn.getAttribute('data-copy');
      const text = document.querySelector(sel).textContent.trim();
      try{
        await navigator.clipboard.writeText(text);
        const old = btn.textContent;
        btn.textContent = 'Tersalin!';
        setTimeout(()=>btn.textContent=old,1200);
      }catch{
        alert('Salin manual: ' + text);
      }
    });
  });

  /* UCAPAN (localStorage) */
  const KEY = 'ucapanList_haret_jauza_dark_v1';
  const form = $('#formUcapan');
  const list = $('#listUcapan');
  const btnClear = $('#btnClear');

  const load = () => JSON.parse(localStorage.getItem(KEY) || '[]');
  const save = arr => localStorage.setItem(KEY, JSON.stringify(arr));
  const escapeHTML = (s='')=> String(s).replace(/[&<>"']/g, m=>({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
  })[m]);

  const render = ()=>{
    const arr = load();
    list.innerHTML = arr.map(x=>`
      <div class="msg">
        <div class="by" style="font-weight:800">${escapeHTML(x.nama)}</div>
        <div>${escapeHTML(x.pesan)}</div>
        <div class="time">${new Date(x.t).toLocaleString()}</div>
      </div>
    `).join('');
  };

  if(form){
    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const nama = $('#nama').value.trim();
      const pesan = $('#pesan').value.trim();
      if(!nama || !pesan) return;
      const arr = load();
      arr.unshift({nama, pesan, t: Date.now()});
      save(arr);
      form.reset();
      render();
    });
  }

  if(btnClear){
    btnClear.addEventListener('click', ()=>{
      if(confirm('Hapus semua ucapan di perangkat ini?')){
        localStorage.removeItem(KEY);
        render();
      }
    });
  }

  document.querySelectorAll('.reveal-up').forEach(el => el.classList.add('show'));
  render();

  /* IMPORTANT FIX: start the auto slideshow on load */
  start();
})();
</script>
</body>
</html>
